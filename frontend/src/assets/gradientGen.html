<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mesh Gradient with Optional Pickers</title>
  <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
  <style>
    * { box-sizing: border-box }
    body {
      margin: 0; display: flex; height: 100vh;
      background: #121212; color: #eee;
      font-family: system-ui, sans-serif;
    }
    .sidebar {
      width: 300px; padding:1rem;
      background:#1d1d1d; overflow-y:auto;
    }
    .sidebar h2 { margin:0 0 .5rem }
    .controls { display:grid; gap:1rem }
    .controls label { display:flex; flex-direction:column; font-size:.9rem }
    .controls select,
    .controls input,
    .controls button {
      margin-top:.25rem; padding:.5rem; border:none;
      border-radius:6px; background:#2d2d2d; color:#fff;
      font-size:.9rem; width:100%;
    }
    .controls button { background:#4caf50; cursor:pointer }
    .controls button:hover { background:#45a049 }
    .picker-container {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
      gap:1rem;
    }
    .picker {
      display:flex; flex-direction:column; align-items:center; gap:.25rem;
    }
    .picker canvas { width:100px; height:100px }
    .slider-label { font-size:.8rem }
    .main {
      flex:1; display:flex; flex-direction:column;
      align-items:center; padding:1rem;
    }
    #canvas {
      background:#000; border-radius:12px;
      box-shadow:0 8px 24px rgba(0,0,0,.5);
      max-width:100%; max-height:100%; width:auto; height:auto;
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <h2>Gradient Generator Controls</h2>
    <div class="controls">
      <label>
        Resolution
        <select id="resolution">
          <optgroup label="Square">
            <option value="600x600">600 × 600</option>
            <option value="900x900">900 × 900</option>
            <option value="1200x1200">1200 × 1200</option>
          </optgroup>
          <optgroup label="Landscape">
            <option value="1280x720">1280 × 720</option>
            <option value="1920x1080">1920 × 1080</option>
            <option value="2560x1440">2560 × 1440</option>
          </optgroup>
          <optgroup label="Portrait">
            <option value="720x1280">720 × 1280</option>
            <option value="1080x1920">1080 × 1920</option>
            <option value="1440x2560">1440 × 2560</option>
          </optgroup>
        </select>
      </label>

      <label>
        Colors
        <input type="number" id="colorCount" min="2" max="8" value="3"/>
      </label>

      <label style="flex-direction:row; align-items:center; gap:.5rem;">
        <input type="checkbox" id="randomColors" checked/>
        Random Colors
      </label>

      <div id="pickers" class="picker-container"></div>

      <label class="slider-label">
        Similarity
        <input type="range" id="similarity" min="0" max="100" value="80"/>
        <span id="simVal">80%</span>
      </label>

      <label class="slider-label">
        Warp Strength
        <input type="range" id="warp" min="0" max="100" value="20"/>
        <span id="warpVal">20%</span>
      </label>

      <button id="btnGenerate">Generate Mesh</button>
    </div>
  </div>

  <div class="main">
    <canvas id="canvas"></canvas>
  </div>

  <script>
  const $ = id => document.getElementById(id);
  const canvas = $('canvas'), ctx = canvas.getContext('2d');

  let pickers = [];

  function setupPickers(){
    const container = $('pickers');
    container.innerHTML = '';
    pickers = [];
    if (!$('randomColors').checked) {
      const count = +$('colorCount').value;
      for(let i=0;i<count;i++){
        const div = document.createElement('div');
        div.className = 'picker';
        const label = document.createElement('div');
        label.textContent = `Color ${i+1}`;
        const pickDiv = document.createElement('div');
        div.append(label,pickDiv);
        container.append(div);
        const picker = new iro.ColorPicker(pickDiv, {
          width:100,
          layout: [
            { component: iro.ui.Wheel, options:{} },
            { component: iro.ui.Box,   options:{} }
          ]
        });
        pickers.push(picker);
      }
    }
  }

  // sync labels
  $('similarity').oninput = e => $('simVal').textContent = e.target.value+'%';
  $('warp').oninput       = e => $('warpVal').textContent = e.target.value+'%';

  function randNormal(){
    let u=0,v=0;
    while(!u) u=Math.random();
    while(!v) v=Math.random();
    return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);
  }

  function generateMesh(){
    // size
    const [w,h] = $('resolution').value.split('x').map(Number);
    canvas.width = w; canvas.height = h;
    if(w>=h){ canvas.style.width='100%'; canvas.style.height='auto' }
    else     { canvas.style.height='100%'; canvas.style.width='auto' }

    // base colors
    const sim = +$('similarity').value;
    let baseColors;
    if($('randomColors').checked){
      baseColors = Array.from({length:+$('colorCount').value},()=>{
        // random hex
        return '#'+Math.floor(Math.random()*0xFFFFFF).toString(16).padStart(6,'0');
      });
    } else {
      baseColors = pickers.map(p=>p.color.hexString);
    }

    const warp = +$('warp').value/100;

    // offscreen
    const off = document.createElement('canvas');
    off.width=w; off.height=h;
    const octx = off.getContext('2d');

    // gradient (random angle)
    const angle = Math.random()*Math.PI*2;
    const cx=w/2, cy=h/2, r=Math.hypot(w,h)/2;
    const gx=Math.cos(angle)*r, gy=Math.sin(angle)*r;
    const grad = octx.createLinearGradient(cx-gx,cy-gy,cx+gx,cy+gy);

    // stops jittered by similarity
    baseColors.forEach((hex,i,arr)=>{
      const [r0,g0,b0] = hex.match(/\w\w/g).map(x=>parseInt(x,16));
      const diff = 255*(100-sim)/100;
      const r1 = Math.min(255,Math.max(0,r0+randNormal()*diff/2));
      const g1 = Math.min(255,Math.max(0,g0+randNormal()*diff/2));
      const b1 = Math.min(255,Math.max(0,b0+randNormal()*diff/2));
      grad.addColorStop(i/(arr.length-1), `rgb(${r1|0},${g1|0},${b1|0})`);
    });

    octx.fillStyle = grad;
    octx.fillRect(0,0,w,h);

    const src = octx.getImageData(0,0,w,h).data;
    const dst = ctx.createImageData(w,h);

    // warp sample
    for(let y=0;y<h;y++){
      for(let x=0;x<w;x++){
        const dx = randNormal()*warp*w;
        const dy = randNormal()*warp*h;
        const sx = Math.min(w-1,Math.max(0,(x+dx)|0));
        const sy = Math.min(h-1,Math.max(0,(y+dy)|0));
        const si = (sy*w+sx)*4, di=(y*w+x)*4;
        dst.data[di  ] = src[si  ];
        dst.data[di+1] = src[si+1];
        dst.data[di+2] = src[si+2];
        dst.data[di+3] = 255;
      }
    }
    ctx.putImageData(dst,0,0);
  }

  // event wiring
  $('randomColors').onchange = ()=>{
    setupPickers();
    generateMesh();
  };
  $('colorCount').onchange = ()=>{
    setupPickers();
    generateMesh();
  };
  ['resolution','similarity','warp'].forEach(id=>
    $(id).addEventListener('change',generateMesh)
  );
  $('btnGenerate').onclick = generateMesh;

  // init
  setupPickers();
  generateMesh();
  </script>
</body>
</html>
